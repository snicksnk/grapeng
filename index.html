<!DOCTYPE html>
<html>
  <head>
    <meta charset=utf-8>
    <title>(Это title) Пример страницы на HTML5</title>

   	<script src="resources/qunit-1.12.0.js"></script>
    <script src="grapheng/GameObj.js"></script>
    <script src="grapheng/Event.js"></script>
    <script src="grapheng/Dispathcer.js"></script>

    <script src="grapheng/Modifier.js"></script>


    <script type="text/javascript" src="resources/raphael-min.js"></script>


    <script src="grapheng/dia.js"></script>

   	<link rel="stylesheet" href="resources/qunit-1.12.0.css">

   

   	<script type="text/javascript">


   		test( "Jump event get name", function() {

			 player=new Player();
   			disp=new Dispathcer();
   			equal(Dispathcer.getEventUniqueId(JumpEvent),'jump','get jump u)nique id');
   		
   			deepEqual(
        Dispathcer.getEventUniqueId(player.subscribeForEvents()[0]), 
        Dispathcer.getEventUniqueId(JumpEvent),'Player will subscrib for right events');



   			disp.addObject(player);

/*
   			for (var i = 0; i < player.subscribeForEvents().length; i++) {
   				player.subscribeForEvents()[i];
   			}
*/
        
        deepEqual(player.getDispatcher(),disp,'Dispatcher is setted');

   			ok(disp._subscriptions['jump']!==undefined, 'Dispatcher has create jump subscribition list');

   			disp.notify(new JumpEvent());

   			equal(player.state, 'jump', 'Player changed state after notifing');

        stateModel = new StateModel();

        equal(stateModel.getNewState(), false, 'State is default');

        stateModel.setState(stateModel.states.moving);

        equal(stateModel.getNewState(), stateModel.states.moving, 'State is changed');

        equal(stateModel.getState(), stateModel.states.moving, 'Current state is moving');

        equal(stateModel.getNewState(), false, 'State didnot chaged last time');


        position=new Position();
        position.setPos({'x':10,'y':30});

        deepEqual(position.getNewPos(),{'x':10,'y':30},'new pos is setted');

        equal(position.getNewPos(),false,'Pos is not been setted');

        deepEqual(position.getPos(),{'x':10,'y':30},'Get setted postion');



        var paper = Raphael(document.getElementById('canvas'), 400, 400);

        node=new Node(paper, new Position({'x':10,'y':220}));



        disp.addObject(node);

        nodeDepends=new Node(paper);

        //nodeDepends.setDependsOf(node);

        disp.addObject(nodeDepends);

        equal(nodeDepends._moveEvent.getUniqueName(),'move_object_3','Event name of depended object is correct');

        equal(node._moveEvent.getUniqueName(),'move_object_2','Event name of master object is correct');


        disp.notify(node._moveEvent);


        

        deepEqual(disp._lastEvent, node._moveEvent, 'Last event of dispatcher is correct for master object');



        line=new Line(paper);

        line.setLineStartNode(node);

        line.setLineEndNode(nodeDepends);
        
        disp.addObject(line);

        node3=new Node(paper, new Position({'x':50,'y':120}));
        disp.addObject(node3);

        line2=new Line(paper);
        line2.setLineStartNode(nodeDepends);
        line2.setLineEndNode(node3);


        disp.addObject(line2);








        /*
        last_time=0;
        setInterval(function() {
        if((new Date) - last_time > 1000/1) {
                last_time = new Date;
                console.log('daa');
            }
        }, 10);
        */

        //setInterval(function() { disp.notify(new FrameEvent()) }, 1000);






		});

    test( "Check onEventEvents", function() {

        disp=new Dispathcer();
        
        CustomEvent=function(){

        }

        CustomEvent.prototype=new Event;

        CustomEvent.prototype.getUniqueName=function(){
            return 'customEvent'
        }

        player=new Player();
        player.eventCompleate=false;
        player.addSubscribition(CustomEvent,function(){
            this.eventCompleate=true;
        });

        disp.notifyOn(FrameEvent, new CustomEvent);







        ok(true, true, 'ok');
    });
 
   	</script>

    <style type="text/css">  
      #canvas {  
          width: 400px;  
          height: 400px;
          border: 1px solid #aaa;  
      }  
    </style> 



  </head>
  <body>
    <header>
    </header>
    <nav>
      <menu>
        <li><a href=link1.html>Первая ссылка из блока "nav"</a></li>
      </menu>
    </nav>
    <section>
      <article>
        <h1>Заголовок статьи из блока "article"</h1>
        <div id="canvas"></div>
          
            <div id="qunit"></div>
			<div id="qunit-fixture"></div>
       
      </article>
    </section>
    <footer>
      <time>Содержимое тега "time" блока "footer"</time>
      <p>Содержимое абзаца из блока "footer"</p>
    </footer>
  </body>
</html>